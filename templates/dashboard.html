{% extends "base.html" %}

{% block title %}Dashboard - {{ app_title }}{% endblock %}

{% block content %}
<div class="page" id="dashboardPage">
    <div class="container">
        <div class="dashboard">
            <div class="header">
                <h1>{{ app_title }}</h1>
                <div class="user-info">
                    <span>Logged in as: {{ username }}</span>
                    <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Total Guests</div>
                    <div class="stat-value">{{ stats.total }}</div>
                </div>
                <div class="stat-card likely">
                    <div class="stat-label">Likely to Come</div>
                    <div class="stat-value">{{ stats.likely }}</div>
                </div>
                <div class="stat-card groom">
                    <div class="stat-label">Groom's Side</div>
                    <div class="stat-value">{{ stats.groom }}</div>
                </div>
                <div class="stat-card bride">
                    <div class="stat-label">Bride's Side</div>
                    <div class="stat-value">{{ stats.bride }}</div>
                </div>
            </div>

            <!-- Add Guest Section -->
            <div class="add-guest-section">
                <h2>Add New Guest</h2>
                <form method="POST" action="{{ url_for('add_guest') }}">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" placeholder="Guest name" required>
                        </div>
                        <div>
                            <label>Count</label>
                            <input type="number" name="count" placeholder="1" min="1" value="1" required>
                        </div>
                        <div>
                            <label>Side</label>
                            <select name="side" required>
                                <option value="">Select...</option>
                                <option value="groom">Groom</option>
                                <option value="bride">Bride</option>
                            </select>
                        </div>
                        <div>
                            <label>Attendance</label>
                            <select name="attendance" required>
                                <option value="">Select...</option>
                                <option value="likely">Likely</option>
                                <option value="unlikely">Unlikely</option>
                            </select>
                        </div>
                        <div>
                            <label>&nbsp;</label>
                            <button type="submit" class="btn-add">Add Guest</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Guest List Section -->
            <div class="guest-list-section">
                <h2>Guest List ({{ guests|length }} entries)</h2>
                
                {% if guests %}
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Count</th>
                            <th>Side</th>
                            <th>Attendance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for guest in guests %}
                        <tr id="guest-row-{{ guest.id }}">
                            <td>
                                <span class="guest-name">{{ guest.name }}</span>
                                <input type="text" class="edit-input" style="display:none;" value="{{ guest.name }}">
                            </td>
                            <td>
                                <span class="guest-count">{{ guest.count }}</span>
                                <input type="number" class="edit-input" style="display:none;" value="{{ guest.count }}" min="1">
                            </td>
                            <td>
                                <span class="guest-side">
                                    <span class="badge {{ guest.side }}">{{ guest.side|capitalize }}</span>
                                </span>
                                <select class="edit-input" style="display:none;">
                                    <option value="groom" {% if guest.side == 'groom' %}selected{% endif %}>Groom</option>
                                    <option value="bride" {% if guest.side == 'bride' %}selected{% endif %}>Bride</option>
                                </select>
                            </td>
                            <td>
                                <span class="guest-attendance">
                                    <span class="badge {{ guest.attendance }}">{{ guest.attendance|capitalize }}</span>
                                </span>
                                <select class="edit-input" style="display:none;">
                                    <option value="likely" {% if guest.attendance == 'likely' %}selected{% endif %}>Likely</option>
                                    <option value="unlikely" {% if guest.attendance == 'unlikely' %}selected{% endif %}>Unlikely</option>
                                </select>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit" onclick="editGuest({{ guest.id }})">Edit</button>
                                    <button class="btn-save" style="display:none;" onclick="saveGuest({{ guest.id }})">Save</button>
                                    <button class="btn-cancel" style="display:none;" onclick="cancelEdit({{ guest.id }})">Cancel</button>
                                    <form method="POST" action="{{ url_for('delete_guest', guest_id=guest.id) }}" style="display:inline;" 
                                          onsubmit="return confirm('Are you sure you want to delete {{ guest.name }}?');">
                                        <button type="submit" class="btn-delete">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <p>No guests added yet. Start by adding your first guest above!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}